################################################################################
#                            CHANGELOG                                         #
################################################################################

================================================================================
2026-01-25 - Building Wand
================================================================================

AJOUTS:
- common/item/tool/BuildingWandItem.java (baguette de construction)
- client/renderer/BuildingWandPreviewRenderer.java (prévisualisation contours)
- assets/beemancer/models/item/building_wand.json
- assets/beemancer/textures/item/building_wand.png

MODIFICATIONS:
- BeemancerItems.java: +BUILDING_WAND
- BeemancerCreativeTabs.java: +BUILDING_WAND
- ClientSetup.java: +BuildingWandPreviewRenderer event registration
- en_us.json/fr_fr.json: +traductions Building Wand

NOUVELLE FEATURE:
- Baguette de construction avec prévisualisation
- Flood fill 2D sur la face pointée (4 cardinaux + 4 diagonales)
- Limite: min(15, items inventaire) - illimité en créatif
- Contours blancs pour prévisualisation
- Placement avec orientation correcte (getStateForPlacement)
- Consommation items de l'inventaire
- Cache de prévisualisation (évite recalcul à chaque frame)

================================================================================
2026-01-25 - Storage Network: Pending Requests System
================================================================================

AJOUTS:
- StorageTerminalBlockEntity.java:
  - +PendingRequest record (queue de requêtes en attente)
  - +serverTick() pour traitement périodique des requêtes
  - +NBT persistence des pending requests
- StorageTerminalMenu.java:
  - +ContainerData pour sync pending count/types vers client
- StorageTerminalScreen.java:
  - +renderPendingIndicator() badge orange avec compteur
  - +renderPendingTooltip() tooltip détaillé

MODIFICATIONS:
- StorageTerminalBlock.java: +getTicker() pour serverTick
- StorageControllerBlockEntity.java: depositItem() réécrit pour prioriser les coffres contenant l'item

NOUVELLE FEATURE:
- Système de file d'attente pour les requêtes overflow
- Si slots pickup pleins, items mis en attente
- Traitement automatique toutes les 10 ticks
- Indicateur visuel dans GUI (badge orange)
- Tooltip avec nombre d'items et types en attente
- Persistance NBT (survit restart)

CORRECTION:
- Dépôt priorise maintenant les coffres contenant déjà l'item

================================================================================
2026-01-25 - Storage Network System Fixes & Improvements
================================================================================

AJOUTS:
- core/network/packets/StorageItemsSyncPacket.java (sync items agrégés vers client)
- core/util/StorageHelper.java (utilitaire vérification conteneurs stockage)

CORRECTIONS:
- StorageControllerBlockEntity.java:
  - +handleUpdateTag() pour sync correcte vers client (fix contour bleu invisible)
  - Fix ConcurrentModificationException dans refreshAggregatedItems()
  - Mode édition auto-exit si joueur déconnecté ou trop loin
  - Nettoyage automatique des viewers déconnectés
  - addViewer() prend maintenant terminalPos pour sync ciblée

- StorageTerminalBlockEntity.java:
  - +handleUpdateTag() pour sync correcte vers client
  - +flag isDepositing pour éviter récursion lors du dépôt automatique

- StorageEvents.java:
  - +onServerStopping() pour nettoyer StorageEditModeHandler
  - Utilisation StorageHelper au lieu de vérification redondante

- StorageControllerBlock.java:
  - Utilisation StorageHelper au lieu de vérification redondante

- StorageRequestPacket.java:
  - Validation count (clamp 1-3456) contre exploits

- StorageControllerRenderer.java:
  - Optimisation: buffer obtenu une seule fois et réutilisé

MODIFICATIONS:
- BeemancerNetwork.java: +StorageItemsSyncPacket (playToClient)

FIXES:
- Les items agrégés sont maintenant envoyés au client via packet dédié
- Les contours bleus autour des coffres enregistrés s'affichent correctement
- La sauvegarde/chargement des coffres enregistrés fonctionne correctement
- Plus de fuite mémoire dans StorageEditModeHandler au quit/reload monde

================================================================================
2026-01-25 - Storage Network System (Complete)
================================================================================

AJOUTS:
- common/block/storage/StorageControllerBlock.java (bloc contrôleur central)
- common/block/storage/StorageTerminalBlock.java (bloc terminal d'accès)
- common/block/storage/StorageEditModeHandler.java (gestionnaire mode édition)
- common/block/storage/StorageEvents.java (interception clics coffres)
- common/blockentity/storage/StorageControllerBlockEntity.java (flood fill, agrégation)
- common/blockentity/storage/StorageTerminalBlockEntity.java (liaison, dépôt/pickup)
- common/menu/storage/StorageTerminalMenu.java (slots dépôt/pickup)
- client/gui/screen/storage/StorageTerminalScreen.java (grille virtuelle, recherche, popup)
- client/renderer/block/StorageControllerRenderer.java (lignes vers coffres)
- core/network/packets/StorageRequestPacket.java (packet demande items)
- assets blockstates/models pour storage_controller et storage_terminal

MODIFICATIONS:
- BeemancerBlocks.java: +STORAGE_CONTROLLER, +STORAGE_TERMINAL
- BeemancerBlockEntities.java: +STORAGE_CONTROLLER, +STORAGE_TERMINAL
- BeemancerItems.java: +STORAGE_CONTROLLER, +STORAGE_TERMINAL (BlockItems)
- BeemancerMenus.java: +STORAGE_TERMINAL
- BeemancerNetwork.java: +StorageRequestPacket
- ClientSetup.java: +StorageTerminalScreen, +StorageControllerRenderer
- Beemancer.java: +StorageEvents registration
- en_us.json/fr_fr.json: +traductions Storage Network

NOUVELLE FEATURE:
- Système de stockage centralisé style AE2/Refined Storage
- Storage Controller avec mode édition (shift+clic droit)
- Enregistrement coffres par flood fill (rayon 24 blocs)
- Visualisation: outline rouge + lignes vertes vers coffres
- Storage Terminal avec liaison automatique en mode édition
- Interface: recherche, grille virtuelle 9x6, popup demande items
- Slots dépôt (auto-transfert vers réseau) et pickup (demandes)
- Sync temps réel (GUI ouverte) ou périodique (40 ticks)

================================================================================
2026-01-24 - Custom Bee Renderer + AI Improvements
================================================================================

AJOUTS:
- client/renderer/entity/MagicBeeRenderer.java (renderer custom avec textures par espèce)
- common/entity/bee/BeeAIStateMachine.java (machine à états centralisée)
- common/entity/bee/BeePathfinding.java (pathfinding A* pour abeilles volantes)
- common/block/hive/HiveBeeSlot.java (encapsulation données slot abeille)
- common/block/hive/HiveFlowerPool.java (pool partagé de fleurs)
- assets/beemancer/textures/entity/bee/ (dossier pour textures espèces)

MODIFICATIONS:
- ClientSetup.java: Utilisation MagicBeeRenderer au lieu de BeeRenderer vanilla
- MagicBeeEntity.java: +cache config, +timer enraged, +getSpeciesId()
- ForagingBehaviorGoal.java: +approche par le haut, +inclinaison butinage, +descente douce
- MagicHiveBlockEntity.java: Refactorisation vers HiveBeeSlot[] et HiveFlowerPool

NOUVELLES FEATURES:
- Renderer custom supportant textures différentes par espèce
- Pattern: textures/entity/bee/{species}.png et {species}_nectar.png
- Cache des textures pour performance
- Machine à états AI centralisée avec timeouts (40 sec SEEKING_FLOWER)
- Pathfinding A* 3D pour navigation intelligente
- Sélection aléatoire des fleurs (évite conflits entre abeilles)
- Comportement réaliste: approche par le haut, inclinaison pendant butinage

================================================================================
2026-01-24 - Alchemy Processing System (Complete)
================================================================================

AJOUTS:
- core/recipe/ProcessingOutput.java (output avec probabilite)
- core/recipe/FluidIngredient.java (ingredient fluide avec codec)
- core/recipe/ProcessingRecipeInput.java (RecipeInput combines items+fluides)
- core/recipe/BeemancerRecipeTypes.java (registre des 4 types de recettes)
- core/recipe/BeemancerRecipeSerializers.java (registre des serializers)
- core/recipe/type/CentrifugeRecipe.java (recette centrifugeuse)
- core/recipe/type/InfusingRecipe.java (recette infuseur)
- core/recipe/type/CrystallizingRecipe.java (recette cristalliseur)
- core/recipe/type/DistillingRecipe.java (recette alambic)
- client/gui/widget/BeemancerSlot.java (slot personnalise avec image de fond)
- client/gui/widget/FluidGaugeWidget.java (jauge de fluide avec rendu visuel)
- data/beemancer/recipe/centrifuging/*.json (4 recettes combs)
- data/beemancer/recipe/infusing/honeyed_wood.json
- data/beemancer/recipe/crystallizing/*.json (2 recettes cristaux)
- data/beemancer/recipe/distilling/nectar.json
- assets/beemancer/blockstates/item_pipe.json
- assets/beemancer/models/block/item_pipe_*.json (core, side, side_extract)
- assets/beemancer/models/block/honey_pipe_side_extract.json

MODIFICATIONS:
- BeemancerMenus.java: Correction code corrompu lignes 62-76
- Beemancer.java: Suppression NECTAR_FILTER, correction capabilities, ajout ItemPipe
- BeemancerCreativeTabs.java: Suppression NECTAR_FILTER, ajout ITEM_PIPE/INFUSER
- PoweredCentrifugeBlockEntity.java: Refactoring vers CentrifugeRecipe
- ManualCentrifugeBlockEntity.java: Refactoring vers CentrifugeRecipe
- InfuserBlockEntity.java: Refactoring vers InfusingRecipe
- CrystallizerBlockEntity.java: Refactoring vers CrystallizingRecipe
- AlembicBlockEntity.java: Refactoring vers DistillingRecipe
- PoweredCentrifugeMenu.java: Utilisation BeemancerSlot
- InfuserMenu.java: Utilisation BeemancerSlot
- CrystallizerMenu.java: Utilisation BeemancerSlot
- PoweredCentrifugeScreen.java: Utilisation FluidGaugeWidget
- ManualCentrifugeScreen.java: Utilisation FluidGaugeWidget
- InfuserScreen.java: Utilisation FluidGaugeWidget
- CrystallizerScreen.java: Utilisation FluidGaugeWidget
- AlembicScreen.java: Utilisation FluidGaugeWidget
- HoneyTankScreen.java: Utilisation FluidGaugeWidget
- blockstates/honey_pipe.json: Ajout modeles extraction

NOUVELLE FEATURE:
- Systeme de recettes JSON modulaire pour l'alchimie
- 4 types de recettes: centrifuging, infusing, crystallizing, distilling
- Support probabilites sur outputs items (CentrifugeRecipe)
- Support inputs/outputs fluides avec FluidIngredient
- GUI ameliorees avec jauges de fluide colorees
- Slots personnalises avec icones de fond (comb, wood, etc.)
- Visuels extraction pour pipes (modele elargi)

================================================================================
2026-01-23 - Codex System (Complete)
================================================================================

AJOUTS:
- common/codex/CodexPage.java (enum des 3 pages: BEE, ALCHEMY, LOGISTICS)
- common/codex/CodexNodeCategory.java (enum catégories visuelles)
- common/codex/CodexNode.java (représentation d'un node)
- common/codex/CodexPlayerData.java (données progression joueur)
- common/codex/CodexManager.java (gestionnaire central, chargement JSON)
- common/item/codex/CodexItem.java (item livre ouvrant le Codex)
- core/network/packets/CodexUnlockPacket.java (packet déblocage)
- core/network/packets/CodexSyncPacket.java (packet synchronisation)
- core/registry/BeemancerAttachments.java (attachment données joueur)
- core/registry/BeemancerSounds.java (sons du mod)
- client/gui/screen/CodexScreen.java (screen principal avec onglets)
- client/gui/widget/CodexNodeWidget.java (widget rendu node)
- data/beemancer/codex/bee.json (6 nodes exemple)
- data/beemancer/codex/alchemy.json (6 nodes exemple)
- data/beemancer/codex/logistics.json (6 nodes exemple)
- assets/beemancer/sounds.json (définition sons)
- assets/beemancer/models/item/codex.json
- assets/beemancer/textures/item/codex.png
- assets/beemancer/textures/gui/codex_*.png

MODIFICATIONS:
- BeemancerItems.java: +CODEX item
- BeemancerCreativeTabs.java: +CODEX dans l'onglet créatif
- BeemancerNetwork.java: +CodexUnlockPacket, +CodexSyncPacket
- Beemancer.java: +BeemancerAttachments, +BeemancerSounds, +CodexManager.load(), +onPlayerLoggedIn()
- en_us.json: +traductions Codex
- fr_fr.json: +traductions Codex

NOUVELLE FEATURE:
- Système de Codex avec 3 onglets (Bees, Alchemy, Logistics)
- Nodes interconnectés formant un arbre de progression
- Nodes cachés jusqu'au déblocage du parent
- Click pour débloquer si parent débloqué
- Sauvegarde par joueur (conservé à la mort)
- Synchronisation client/server
- Sons de navigation et déblocage
- Scroll/drag dans la zone de contenu
- 4 catégories visuelles (ROOT, NORMAL, GOAL, CHALLENGE)

================================================================================
2026-01-22 - Bee Wand Refonte (Complete)
================================================================================

AJOUTS:
- common/item/bee/WandTrackedData.java (définition donnée trackée)
- common/item/bee/WandClassTracker.java (configuration tracking par classe)
- client/gui/hud/WandOverlayRenderer.java (renderer HUD overlay)

MODIFICATIONS:
- BeeWandItem.java: Refonte complète avec système de tracking générique
  - Configuration des classes trackées dans bloc static {}
  - Tracking MagicBeeEntity (9 données: Species, Health, Lifetime, etc.)
  - Tracking MagicHiveBlockEntity (4 données: Breeding Mode, Bees Inside/Outside, Empty Slots)
  - Sélection par clic, désélection par Shift+clic droit
- ClientSetup.java: +enregistrement WandOverlayRenderer sur NeoForge.EVENT_BUS

NOUVELLE ARCHITECTURE:
- Système de tracking générique extensible via WandClassTracker<T>
- HUD overlay en haut à gauche quand baguette tenue
- Affichage dynamique des valeurs tick par tick

================================================================================
2026-01-22 - Structure Documentation Refonte
================================================================================

AJOUTS:
- Structure/ (dossier à la racine)
- Structure/registries_items.txt
- Structure/registries_blocks.txt
- Structure/registries_entities.txt
- Structure/registries_menus.txt
- Structure/registries_flower_genes.txt
- Structure/feature_*.txt (1 fichier par feature)
- Structure/dependencies.txt
- Structure/integration_guide.txt
- Structure/changelog.txt

MODIFICATIONS:
- Structure.txt: Références aux fichiers de détail avec instructions d'extension

================================================================================
2026-01-22 - Harvester Behavior System (Complete)
================================================================================

AJOUTS:
- core/behavior/SpeedThreshold.java (record seuil vitesse)
- core/util/FlowerSearchHelper.java (recherche fleurs dans rayon)
- core/util/HarvestHelper.java (logique récolte par type bloc)
- common/entity/bee/BeeInventory.java (inventaire interne récolteuses)

MODIFICATIONS:
- BeeBehaviorConfig.java: +areaOfEffect, +returnThreshold, +speedThresholds, +getEffectiveSpeedMultiplier()
- BeeBehaviorManager.java: +parsing nouveaux paramètres JSON
- MagicBeeEntity.java: +BeeInventory, +getInventory(), +getEffectiveFlyingSpeed(), +shouldReturnDueToInventory()
- MagicHiveBlockEntity.java: +détection fleurs par abeille, +getAndAssignFlower(), +returnFlower(), +dépôt inventaire récolteuse
- HarvestingBehaviorGoal.java: Implémentation complète (state machine, récolte par type, inventaire)
- ForagingBehaviorGoal.java: Utilisation de la liste de fleurs de la ruche
- species_behaviors.json: +areaOfEffect, +speedThresholds, +returnThreshold, +espèce industrious

================================================================================
2026-01-22 - Bee Behavior System
================================================================================

AJOUTS:
- core/behavior/BeeBehaviorType.java (enum FORAGER/HARVESTER)
- core/behavior/BeeBehaviorConfig.java (configuration par espèce)
- core/behavior/BeeBehaviorManager.java (chargement JSON)
- core/behavior/LootEntry.java (record pour loot)
- common/entity/bee/BeeActivityState.java (enum états)
- common/entity/bee/goal/ReturnToHiveWhenLowHealthGoal.java
- common/entity/bee/goal/BeeRevengeGoal.java
- common/entity/bee/goal/ForagingBehaviorGoal.java
- common/entity/bee/goal/HarvestingBehaviorGoal.java
- content/gene/flower/TreesFlowerGene.java
- content/gene/flower/MushroomsFlowerGene.java
- content/gene/flower/CrystalsFlowerGene.java
- content/gene/flower/NetherWartFlowerGene.java
- data/beemancer/behavior/species_behaviors.json
- data/beemancer/tags/blocks/bee_flowers_trees.json
- data/beemancer/tags/blocks/bee_flowers_mushrooms.json
- data/beemancer/tags/blocks/bee_flowers_crystals.json
- data/beemancer/tags/blocks/bee_flowers_nether_wart.json

MODIFICATIONS:
- MagicBeeEntity.java: +goals AI, +états (pollinated, enraged), +hurt(), +shouldFlee()
- MagicHiveBlockEntity.java: +cooldowns, +régénération, +dépôt loot, +auto-release
- MagicBeeItem.java: +storedHealth
- GeneInit.java: +4 nouveaux FlowerGenes
- Beemancer.java: +chargement BeeBehaviorManager au démarrage serveur

================================================================================
2026-01-22 - Breeding System
================================================================================

- Ajout MagicBreedingCrystalBlock (active breeding au-dessus d'une ruche)
- Ajout BeeLarvaItem (item larve avec gènes)
- Ajout LarvaSlot (slot acceptant uniquement larves)
- Ajout BreedingManager (logique breeding + héritage gènes)
- Ajout IncubatorBlock/BlockEntity/Menu/Screen (machine incubation)
- Modification MagicHiveBlockEntity (logique breeding intégrée)
- Modification MagicHiveMenu (ContainerData pour sync breeding mode)
- Modification MagicHiveScreen (indicateur mode breeding)
- Config breeding: data/beemancer/breeding/species_combinations.json

================================================================================
2026-01-22 - Lifetime System + Magic Hive
================================================================================

- Ajout catégorie LIFETIME aux gènes (short, normal, long)
- MagicBeeEntity: countdown lifetime, mort automatique à 0
- MagicBeeItem: barre de durabilité (lifetime)
- Création MagicHiveBlock avec système d'assignation
- 5 slots bee + 7 slots output honeycomb
- États de tracking: EMPTY, INSIDE, OUTSIDE
- Notification ruche quand abeille meurt
- Slots custom: OutputOnlySlot, BeeAssignmentSlot

================================================================================
2026-01-21 - Refonte Gene System
================================================================================

- Remplacement DebugBee par MagicBee avec système de gènes
- Création du système de gènes modulaire (core/gene/)
- Création des catégories: Species, Environment, Flower
- Création du BeeCreator avec GUI
- Mise à jour BeeWand pour MagicBee
- 9 gènes implémentés (3 par catégorie)

################################################################################
