################################################################################
#                            CHANGELOG                                         #
################################################################################

================================================================================
2026-01-30 - Refactorisation: split des 2 plus gros BlockEntity en managers
================================================================================

Extraction de managers avec back-reference (pattern Create/Mekanism) pour
améliorer la maintenabilité. NBT 100% compatible, API externe préservée.

FICHIERS CRÉÉS (5):

1. common/blockentity/storage/StorageChestManager.java (~158 lignes)
   - Gestion coffres enregistrés, BFS flood fill, toggle, range check
   - Champs: registeredChests
   - NBT: "RegisteredChests"

2. common/blockentity/storage/StorageItemAggregator.java (~367 lignes)
   - Agrégation items, dépôt, extraction, sync viewers, inner class ItemStackKey
   - Champs: aggregatedItems, syncTimer, needsSync, playersViewing
   - NBT: aucun (état runtime)

3. common/blockentity/storage/StorageDeliveryManager.java (~446 lignes)
   - Queue livraison, spawn bees, honey consumption, extract/deposit delivery
   - Champs: deliveryQueue, activeTasks, completedTaskIds, timers, honeyDepleted
   - NBT: "DeliveryQueue", "CompletedTaskIds", "HoneyDepleted"

4. common/blockentity/storage/StorageMultiblockManager.java (~243 lignes)
   - Formation/destruction multibloc, blockstate FORMED/FORMED_ROTATION updates
   - Champs: storageFormed, multiblockRotation
   - NBT: "StorageFormed", "MultiblockRotation"

5. common/block/hive/HiveBeeLifecycleManager.java (~258 lignes)
   - Release/entry abeilles, breeding auto, loot pollinisation, tick slots
   - Champs: aucun (opère via back-reference)
   - NBT: aucun

FICHIERS MODIFIÉS (2):

- StorageControllerBlockEntity.java: 1376→405 lignes
  Délègue à 4 managers, conserve inline: editMode, linkedTerminals, essenceSlots
  syncToClient() changé de private à package-private

- MagicHiveBlockEntity.java: 786→528 lignes
  Délègue à lifecycleManager, conserve: Container, NBT, flower management, helpers
  getSpeciesId() déplacé en static sur HiveBeeLifecycleManager

BILAN:
- ~1200 lignes extraites en managers spécialisés
- 5 nouveaux fichiers
- 2 fichiers simplifiés
- Zéro changement de comportement, NBT 100% compatible

================================================================================
2026-01-30 - Refactorisation: extraction classes utilitaires et base classes
================================================================================

Analyse complète du projet (231 fichiers, 38 419 lignes) et refactorisation
structurelle pour réduire la duplication et améliorer la maintenabilité.
Aucun changement de comportement.

FICHIERS CRÉÉS (5):

1. client/renderer/util/FluidCubeRenderer.java
   - Méthode statique renderFluidCube() extraite de 3 renderers identiques
   - Rendu d'un cube fluide avec 6 faces et 24 vertices

2. client/renderer/util/DebugRenderHelper.java
   - drawLine() et drawCubeOutline() extraits de BeeDebugRenderer et StorageControllerRenderer
   - Support Vec3 et float[] pour compatibilité avec les deux appelants

3. common/block/alchemy/AbstractPipeBlock.java
   - Base commune pour HoneyPipeBlock et ItemPipeBlock (étaient 95% identiques)
   - Contient: propriétés BlockState, VoxelShape cache, connexion, tinting, interactions
   - Template Method avec 8 méthodes abstraites pour les spécificités

4. common/menu/BeemancerMenu.java
   - Base classe pour tous les menus Beemancer
   - addPlayerInventory() et addPlayerHotbar() partagés par 10 menus

5. common/entity/bee/goal/MoveToTargetGoal.java
   - Classe interne extraite de MagicBeeEntity vers fichier autonome
   - Goal de navigation manuelle via BeeWand

FICHIERS MODIFIÉS (18):

Renderers fluide (→ FluidCubeRenderer):
- HoneyTankRenderer.java: supprimé renderFluidCube() local (163→81 lignes)
- HoneyReservoirRenderer.java: supprimé renderFluidCubeWithSprite() (~76 lignes)
- MultiblockTankRenderer.java: supprimé renderFluidCube() (~76 lignes)

Renderers debug (→ DebugRenderHelper):
- BeeDebugRenderer.java: supprimé renderLine(), addColoredLineVertex(), addLineVertex() (234→174 lignes)
- StorageControllerRenderer.java: supprimé drawLine(), outline inline code

Pipes (→ AbstractPipeBlock):
- HoneyPipeBlock.java: extends AbstractPipeBlock (401→153 lignes)
- ItemPipeBlock.java: extends AbstractPipeBlock (385→124 lignes)

Menus (→ BeemancerMenu):
- ManualCentrifugeMenu.java: extends BeemancerMenu, supprimé addPlayerInventory/Hotbar
- PoweredCentrifugeMenu.java: idem
- AlembicMenu.java: idem
- InfuserMenu.java: idem
- CrystallizerMenu.java: idem
- HoneyTankMenu.java: idem
- MultiblockTankMenu.java: idem
- IncubatorMenu.java: idem
- MagicHiveMenu.java: idem
- StorageControllerMenu.java: idem

Entity:
- MagicBeeEntity.java: supprimé inner class MoveToTargetGoal, import externe

BILAN:
- ~900 lignes de duplication éliminées
- 5 nouvelles classes utilitaires/base
- 18 fichiers existants simplifiés
- Zéro changement de comportement

================================================================================
2026-01-30 - Controller Pipe + Honey Consumption + Cleanup
================================================================================

NOUVEAU BLOC:
- ControllerPipeBlock: conduit structurel pour le multibloc Storage Controller
- Cube simple quand non formé, coude orienté quand formé (rendu BER)
- Remplace honey_pipe T1 aux 4 positions de pipe dans le pattern multibloc
- ControllerPipeBlockEntity: stocke rotation (0-7), spreadX/Z
- ControllerPipeRenderer: rendu du coude formed avec spread + rotation

HONEY CONSUMPTION:
- Le controller consomme du miel en continu quand formé (toutes les secondes)
- Drain depuis les 2 HoneyReservoirs du multibloc
- Formule: (base 20 mB/s + coffres × 10 + essences × level × 10) × (1 - efficiency)
- Insomnia essence donne honey efficiency: level × 10% (PERFECT = 40%)
- Si plus de miel: delivery bees bloquées (honeyDepleted)
- ContainerData étendu de 4 à 6 indices (+ consumption, efficiency)

GUI:
- 2 nouvelles stats dans StorageControllerScreen: "Honey" (mB/s), "Efficiency" (%)
- StorageControllerMenu: SimpleContainerData(6), getters consumption/efficiency

NETTOYAGE:
- Supprimé HoneyPipeRenderer.java (remplacé par ControllerPipeRenderer)
- Retiré champs formed de HoneyPipeBlockEntity (formed, formedRotation, formedSpreadX/Z)
- Terminal blockstate simplifié: toutes les variantes utilisent le modèle de base

REGISTRES:
- BeemancerBlocks: +CONTROLLER_PIPE
- BeemancerItems: +CONTROLLER_PIPE (BlockItem)
- BeemancerBlockEntities: +CONTROLLER_PIPE

ASSETS:
- blockstates/controller_pipe.json
- models/block/storage/controller_pipe.json (cube, texture honeyed_stone)
- models/block/storage/controller_pipe_formed.json (coude, copie honey_pipe_formed)
- models/item/controller_pipe.json
- data/beemancer/loot_table/blocks/controller_pipe.json
- Lang EN/FR: block.beemancer.controller_pipe, gui honey_consumption, honey_efficiency

================================================================================
2026-01-30 - Storage Controller: Controlled Hive, Terminal 2px, Spread 3px
================================================================================

Améliorations visuelles et structurelles du multibloc Storage Controller.

NOUVEAU BLOC:
- ControlledHiveBlock: bloc passif avec FORMED + FORMED_ROTATION
- Remplace le honeyed_stone en position (0,1,0) dans le pattern multibloc
- Le controller gère les abeilles via cette hive (spawn/retour)

TERMINAL FORMED:
- Réduit à 2px d'épaisseur (z=[14,16] au lieu de [13,16])
- Design: cadre de barres 2px + plan central texture portal nether

SPREAD COLONNES:
- Les colonnes pipe-reservoir-pipe écartées de 3px (3/16 bloc) du centre
- Spread calculé en world-space par StorageControllerBlockEntity
- HoneyPipeBlockEntity + HoneyReservoirBlockEntity: formedSpreadX/Z (NBT + sync)
- HoneyPipeRenderer + HoneyReservoirRenderer: translation spread avant rendu
- HoneyReservoirRenderer: rendu formed model via BER (blockstate model vidé)

REGISTRES:
- BeemancerBlocks: +CONTROLLED_HIVE
- BeemancerItems: +CONTROLLED_HIVE (BlockItem)

ASSETS:
- blockstates/controlled_hive.json (8 variants)
- models/block/storage/controlled_hive.json + controlled_hive_formed.json
- models/block/altar/honey_reservoir_formed_render.json (modèle pour BER)
- models/item/controlled_hive.json
- textures/block/storage/controlled_hive.png
- data/beemancer/loot_table/blocks/controlled_hive.json
- lang/en_us.json + fr_fr.json: +block.beemancer.controlled_hive

================================================================================
2026-01-29 - Storage Controller Multibloc
================================================================================

Transformation du Storage Controller en multibloc 3x3x3 (3 étages).
Utilise le système FORMED (blockstate property) comme l'altar.

JAVA MODIFIÉS:
- StorageControllerBlock.java: +FORMED property, formation clic droit, onRemove
- StorageControllerBlockEntity.java: implements MultiblockController, tryFormStorage()
- StorageTerminalBlock.java: +FORMED property
- HoneyPipeBlock.java: +FORMED property (13e boolean)
- MultiblockPatterns.java: +STORAGE_CONTROLLER pattern

JSON CRÉÉS:
- models/block/storage/storage_controller_formed.json (2 cubes 2×2×2)
- models/block/storage/storage_terminal_formed.json (3 plaques en Z)
- models/block/pipes/honey_pipe_formed.json (colonne 6×16×6)
- models/block/altar/honeyed_stone_formed.json (base + ailes)

JSON MODIFIÉS:
- models/block/altar/honey_reservoir_formed.json (cube 8×16×8)
- blockstates/storage_controller.json (formed variants)
- blockstates/storage_terminal.json (formed variants)
- blockstates/honey_pipe.json + tier2/3/4 (formed conditions multipart)
- blockstates/honeyed_stone.json (formed=true,layer=0 → modèle formed)

================================================================================
2026-01-29 - Suppression Système Lifetime
================================================================================

SUPPRESSIONS:
- content/gene/lifetime/ (dossier complet avec 3 gènes)
- GeneCategory.LIFETIME
- data/beemancer/genes/lifetime.json
- Structure/feature_lifetime_system.txt

MODIFICATIONS:
- BeeGeneData.java: Retiré tous les champs/méthodes lifetime
- MagicBeeEntity.java: Retiré DATA_LIFETIME_GENE, DATA_REMAINING_LIFETIME, tick lifetime
- MagicBeeItem.java: Retiré barre de durabilité et tooltip lifetime
- GeneInit.java: Retiré registerLifetimeGenes()
- BeeWandItem.java: Retiré track "Lifetime"
- BreedingManager.java: Retiré LIFETIME_COST_RATIO
- MagicHiveBlockEntity.java: Retiré coût lifetime dans attemptBreeding()
- HiveMultiblockBlockEntity.java: Retiré coût lifetime dans attemptBreeding()
- BeeStatueBlock.java: Retiré initializeLifetimeFromGene()

RAISON: Système obsolète, remplacé par abeilles immortelles.

================================================================================
2026-01-28 - Rideable Bee System (Architecture Cobblemon)
================================================================================

Système de monture pour abeilles basé sur l'architecture Cobblemon.
- RidingBehaviour stateless + RidingBehaviourState mutable
- Modes WALK (caméra libre) et RUN (style jet)
- HUD debug en haut à droite

================================================================================
2026-01-27 - Honey Altar + Reservoir Multibloc
================================================================================

Multibloc Honey Altar 3x3x5 avec:
- HoneyReservoirBlock (stockage fluide 4000mB)
- AltarHeartBlock (contrôleur)
- Renderer custom multibloc

================================================================================
HISTORIQUE ANTÉRIEUR: Voir commits Git
================================================================================

################################################################################
